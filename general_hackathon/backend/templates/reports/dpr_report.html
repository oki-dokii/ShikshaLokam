<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>DPR Analysis Report - {{ dpr.get('projectName', 'DPR Report') }}</title>
    <style>
        @page {
            size: A4;
            margin: 2cm 1.5cm;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            font-size: 11pt;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 3px solid #0ea5e9;
        }
        
        .header h1 {
            color: #0ea5e9;
            font-size: 24pt;
            margin: 0 0 10px 0;
        }
        
        .header .subtitle {
            font-size: 12pt;
            color: #666;
        }
        
        .section {
            margin-bottom: 30px;
            page-break-inside: avoid;
        }
        
        .section-title {
            background: #0ea5e9;
            color: white;
            padding: 10px 15px;
            font-size: 16pt;
            font-weight: bold;
            margin-bottom: 15px;
        }
        
        .subsection-title {
            color: #0ea5e9;
            font-size: 14pt;
            font-weight: bold;
            margin: 20px 0 10px 0;
            border-bottom: 2px solid #e5e7eb;
            padding-bottom: 5px;
        }
        
        .info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .info-card {
            background: #f9fafb;
            padding: 12px;
            border-left: 4px solid #0ea5e9;
        }
        
        .info-card .label {
            font-size: 9pt;
            color: #666;
            text-transform: uppercase;
            margin-bottom: 5px;
        }
        
        .info-card .value {
            font-size: 14pt;
            font-weight: bold;
            color: #0ea5e9;
        }
        
        .score-box {
            background: #e0f2fe;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            margin: 10px 0;
        }
        
        .score-box .label {
            font-size: 10pt;
            color: #666;
            margin-bottom: 5px;
        }
        
        .score-box .value {
            font-size: 20pt;
            font-weight: bold;
            color: #0ea5e9;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        
        table th {
            background: #f3f4f6;
            padding: 10px;
            text-align: left;
            font-weight: bold;
            border-bottom: 2px solid #0ea5e9;
        }
        
        table td {
            padding: 10px;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .chart {
            text-align: center;
            margin: 20px 0;
            page-break-inside: avoid;
        }
        
        .chart img {
            max-width: 100%;
            height: auto;
        }
        
        ul {
            margin: 10px 0;
            padding-left: 25px;
        }
        
        li {
            margin-bottom: 8px;
        }
        
        .risk-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 9pt;
            font-weight: bold;
            margin-right: 10px;
        }
        
        .risk-high {
            background: #fee2e2;
            color: #991b1b;
        }
        
        .risk-medium {
            background: #ffedd5;
            color: #9a3412;
        }
        
        .risk-low {
            background: #dcfce7;
            color: #166534;
        }
        
        .milestone {
            display: flex;
            align-items: flex-start;
            margin-bottom: 12px;
        }
        
        .milestone-number {
            background: #0ea5e9;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 15px;
            flex-shrink: 0;
        }
        
        .footer {
            margin-top: 40px;
            padding-top: 20px;
            border-top: 2px solid #e5e7eb;
            text-align: center;
            font-size: 9pt;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>DPR Analysis Report</h1>
        <div class="subtitle">{{ dpr.get('projectName') or 'Detailed Project Report' }}</div>
        <div class="subtitle">Generated on {{ generated_date }}</div>
    </div>

    <!-- OVERVIEW SECTION -->
    <div class="section">
        <div class="section-title">üìä Project Overview</div>
        
        <div class="info-grid">
            {% if dpr.get('projectName') %}
            <div class="info-card">
                <div class="label">Project Name</div>
                <div class="value" style="font-size: 12pt;">{{ dpr.get('projectName') }}</div>
            </div>
            {% endif %}
            
            {% if dpr.get('projectLocation', {}).get('state') %}
            <div class="info-card">
                <div class="label">Location</div>
                <div class="value" style="font-size: 12pt;">{{ dpr.projectLocation.state }}</div>
            </div>
            {% endif %}
            
            {% if dpr.projectSector %}
            <div class="info-card">
                <div class="label">Sector</div>
                <div class="value" style="font-size: 12pt;">{{ dpr.projectSector }}</div>
            </div>
            {% endif %}
            
            {% if dpr.recommendation %}
            <div class="info-card">
                <div class="label">Recommendation</div>
                <div class="value" style="font-size: 12pt;">{{ dpr.recommendation }}</div>
            </div>
            {% endif %}
        </div>

        {% if dpr.overallScore %}
        <div class="score-box">
            <div class="label">Overall Score</div>
            <div class="value">{{ dpr.overallScore }}/100</div>
        </div>
        {% endif %}
        
        {% if dpr.executiveSummary %}
        <div class="subsection-title">Executive Summary</div>
        <p>{{ dpr.executiveSummary }}</p>
        {% endif %}
        
        {% if dpr.scopeAndObjectives %}
            {% if dpr.scopeAndObjectives.vision %}
            <div class="subsection-title">Vision</div>
            <p>{{ dpr.scopeAndObjectives.vision }}</p>
            {% endif %}
            
            {% if dpr.scopeAndObjectives.mission %}
            <div class="subsection-title">Mission</div>
            <p>{{ dpr.scopeAndObjectives.mission }}</p>
            {% endif %}
            
            {% if dpr.scopeAndObjectives.objectives %}
            <div class="subsection-title">Key Objectives</div>
            <ul>
                {% for objective in dpr.scopeAndObjectives.objectives %}
                <li>{{ objective }}</li>
                {% endfor %}
            </ul>
            {% endif %}
        {% endif %}
    </div>

    <!-- FINANCIAL ANALYSIS SECTION -->
    {% if dpr.financialAnalysis %}
    <div class="section">
        <div class="section-title">üí∞ Financial Analysis</div>
        
        {% if dpr.financialAnalysis.projectCost %}
        <div class="info-grid">
            {% if dpr.financialAnalysis.projectCost.totalInitialInvestmentLakhINR %}
            <div class="info-card">
                <div class="label">Total Investment</div>
                <div class="value">‚Çπ{{ dpr.financialAnalysis.projectCost.totalInitialInvestmentLakhINR }} Lakhs</div>
            </div>
            {% endif %}
            
            {% if dpr.financialAnalysis.projectCost.capitalExpenditureLakhINR %}
            <div class="info-card">
                <div class="label">Capital Expenditure</div>
                <div class="value">‚Çπ{{ dpr.financialAnalysis.projectCost.capitalExpenditureLakhINR }} Lakhs</div>
            </div>
            {% endif %}
            
            {% if dpr.financialAnalysis.profitability and dpr.financialAnalysis.profitability.avgDSCR %}
            <div class="info-card">
                <div class="label">Average DSCR</div>
                <div class="value">{{ dpr.financialAnalysis.profitability.avgDSCR }}</div>
            </div>
            {% endif %}
            
            {% if dpr.financialAnalysis.profitability and dpr.financialAnalysis.profitability.irrPercent %}
            <div class="info-card">
                <div class="label">IRR</div>
                <div class="value">{{ dpr.financialAnalysis.profitability.irrPercent }}%</div>
            </div>
            {% endif %}
        </div>
        {% endif %}
        
        {% if charts.capital_structure %}
        <div class="chart">
            <img src="data:image/png;base64,{{ charts.capital_structure }}" alt="Capital Structure">
        </div>
        {% endif %}
        
        {% if charts.project_cost %}
        <div class="chart">
            <img src="data:image/png;base64,{{ charts.project_cost }}" alt="Project Cost Breakdown">
        </div>
        {% endif %}
        
        {% if charts.cost_distribution %}
        <div class="chart">
            <img src="data:image/png;base64,{{ charts.cost_distribution }}" alt="Fixed Cost Distribution">
        </div>
        {% endif %}
    </div>
    {% endif %}

    <!-- TIMELINE SECTION -->
    {% if dpr.timelineAnalysis %}
    <div class="section">
        <div class="section-title">üìÖ Timeline Analysis</div>
        
        {% if dpr.timelineAnalysis.implementationDurationMonths %}
        <div class="subsection-title">Implementation Duration</div>
        <p><strong>{{ dpr.timelineAnalysis.implementationDurationMonths }} Months</strong></p>
        {% endif %}
        
        {% if dpr.timelineAnalysis.keyMilestones %}
        <div class="subsection-title">Key Milestones</div>
        {% for milestone in dpr.timelineAnalysis.keyMilestones %}
        <div class="milestone">
            <div class="milestone-number">{{ loop.index }}</div>
            <div>{{ milestone }}</div>
        </div>
        {% endfor %}
        {% endif %}
        
        {% if dpr.timelineAnalysis.operationsCalendar %}
        <div class="subsection-title">Operations Calendar</div>
        <p>{{ dpr.timelineAnalysis.operationsCalendar }}</p>
        {% endif %}
        
        {% if dpr.timelineAnalysis.timelineRisks %}
        <div class="subsection-title">Timeline Risks</div>
        <ul>
            {% for risk in dpr.timelineAnalysis.timelineRisks %}
            <li>{{ risk }}</li>
            {% endfor %}
        </ul>
        {% endif %}
    </div>
    {% endif %}

    <!-- RISK ASSESSMENT SECTION -->
    {% if dpr.riskAssessment %}
    <div class="section">
        <div class="section-title">‚ö†Ô∏è Risk Assessment</div>
        
        <table>
            <thead>
                <tr>
                    <th>Severity</th>
                    <th>Category</th>
                    <th>Description</th>
                </tr>
            </thead>
            <tbody>
                {% for risk in dpr.riskAssessment %}
                <tr>
                    <td>
                        <span class="risk-badge {% if risk.severity == 'High' %}risk-high{% elif risk.severity == 'Medium' %}risk-medium{% else %}risk-low{% endif %}">
                            {{ risk.severity or 'N/A' }}
                        </span>
                    </td>
                    <td><strong>{{ risk.riskCategory or 'N/A' }}</strong></td>
                    <td>{{ risk.description or 'N/A' }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% endif %}



    <div class="footer">
        <p><strong>DPR Analyzer</strong> - Comprehensive Project Report Analysis</p>
        <p>This report was automatically generated using AI-powered analysis.</p>
    </div>
</body>
</html>
